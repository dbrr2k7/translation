{% extends "base.html" %}

{% block content %}

    <script type="text/javascript" src="/static/js/marked.js"></script>
    <script type="text/javascript" src="/static/js/simplemde.min.js"></script>
    <script type="text/javascript" src="/static/editor/libs.js"></script>
    <script type="text/javascript" src="/static/editor/syntax.js"></script>
    <script type="text/javascript" src="/static/editor/buttons.js"></script>
    <script type="text/javascript" src="/static/editor/editor.js"></script>
    <script type="text/javascript" src="/static/js/katex.js"></script>
    <script type="text/javascript" src="/static/js/auto-render.min.js"></script>

    <link rel="stylesheet" href="/static/css/simplemde.min.css">
    <link type="text/css" rel="stylesheet" href="/static/editor/editor.css">
    <link type="text/css" rel="stylesheet" href="/static/css/katex.css">


    <div class="col-sm-12">
        <div class="panel panel-default panel-btn">
            <div class="panel-body">
                <button class="btn btn-default" onclick="send_data({{ quesId }})">Save</button>
            </div>
        </div>
    </div>


    <div class="col-sm-6">
        <div class="panel panel-default panel-btn">
            <div class="panel-body">
                <button class="btn btn-default" onclick="preview()">Preview</button>
            </div>
        </div>

        <div class="panel panel-default panel-btn">
            <div class="panel-body">

                {% block translation_editor %}

                {% endblock %}

                <div id="katexTemp1">
                    <div id="katexTemp" style="background: #f5f5f5; padding: 10px; white-space: pre-line;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-sm-6">
        <div class="panel panel-default panel-btn">
            <div class="panel-body">
                <input id="q_op_0" name="op" type="radio" value="0"> Preview
                <input id="q_op_1" name="op" type="radio" value="1"> Markdown

                <input id="q_op_2" name="op" type="radio" value="2"> Interactive
            </div>
        </div>

        <div class="panel panel-default panel-btn">
            <div class="panel-body">
                <div id="original" style="white-space: pre-line; background: #f5f5f5; padding: 10px; margin-top: 2.5%">{{ task }}</div>
            </div>
        </div>
    </div>


{% comment %}
            <form action="{% url 'generatepdf' %}" method="post" style="float: left;margin-right: 2%;margin-left: 37%">
                {% csrf_token %}
                <input class="btn" type="submit" name="GeneratePDF" value="PDF"/>
                <input type="hidden" name="quesId" value="{{ quesId }}"/>
                <input type="hidden" name="isAdmin" value="No"/>
            </form>

            <div class="row" style="background:#e7e7e7"></div>

            <script>
                $('#myForm').submit(function(e) {
                    document.getElementsByName("katexhtml").value = document.getElementById("katexTemp").innerHTML;
                    e.preventDefault()
                    $.ajax({
                        url: " {% url 'generatepdf' %}",
                        data: {
                            'katexhtml': document.getElementById("katexTemp").innerHTML,
                            'isAdmin':'No',
                            'quesId': {{quesId}},
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        },
                        type: "POST",
                        success: function (response) {
                            console.log('in success');
                            jso = jQuery.parseJSON(response);
                            $('#test').html(jso['content']);
                            console.log('after success')
                        },
                        complete: function () {
                        },
                        error: function (xhr, textStatus, thrownError) {
                        }
                    });
                });
           </script>

{% endcomment %}



    <script type="text/javascript">
        marked.setOptions({
            renderer: new marked.Renderer(),
            gfm: true,
            tables: true,
            breaks: false,
            pedantic: false,
            sanitize: false,
            smartLists: true,
            smartypants: false
        });

        $(document).ready(function () {
            var cont = $('#original').text();
            $('#original').html(marked(cont));
            $('#myVar').html(cont);
            renderMathInElement(document.getElementById("editor"));
            $('#katexTemp1').hide();
        });


    </script>

    <input type="hidden" id="myVar" name="variable" value="{{ variable }}"/>
    <input type="hidden" id="myVarTrans" name="variable" value="{{ variable }}"/>

{% endblock %}