{% extends "base.html" %}

{% block content %}

    <div class="container">
        <div class="col-sm-10 col-sm-offset-1">
            <div class="btn-container" style="border-width: 1px;">
                <label>Actions: </label>
                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#addTaskModal">Add New Task</button>
                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#sendNotifModal">Send Notification</button>
            </div>
        </div>
        {% for contest_tasks in tasks_lists %}

            <div class="body container col-sm-10 col-sm-offset-1">
                <h2>{{contest_tasks.title}}</h2>
                <table class="table table-hover">
                    <thead><tr>
                        <th width="40%">Task</th>
                        <th width="30%">Edit</th>
                        <th>ISC Version</th>
                    </tr></thead>
                    <tbody>
                    {% for task in contest_tasks.tasks %}
                        <tr>
                            <td> {{ task.name }} </td>
                            <td>
                                {% if task.is_editing %} Is editing
                                {% elif task.frozen %} Frozen
                                {% else %}<a href="{% url 'edit_translation' contest_slug=contest_tasks.slug task_name=task.name %}">Edit</a>{% endif %}
                            </td>
                            <td>
                                <a href="{% url 'trans_md' contest_slug=contest_tasks.slug task_name=task.name %}" class="btn btn-default" title="Markdown"><i class="fa fa-btn fa-file-text-o fa-lg"></i></a>
                                <a href="{% url 'versions' contest_slug=contest_tasks.slug task_name=task.name %}" class="btn btn-default" title="History"><i class="fa fa-btns fa-history fa-lg"></i></a>
                                <a href="{% url 'trans_pdf' contest_slug=contest_tasks.slug task_name=task.name%}" class="btn btn-default" title="PDF"><i class="fa fa-btns fa-file-pdf-o fa-lg"></i></a>
                                <a href="{% url 'gettranspreview' contest_slug=contest_tasks.slug task_name=task.name%}" class="btn btn-default" title="Print"><i class="fa fa-btns fa-print fa-lg"></i></a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        {% endfor %}

        <!-- Add Task Modal -->
        <div class="modal fade" id="addTaskModal" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Add New Task</h4>
                    </div>
               
                    <div class="modal-body">
                        <form class="form-horizontal" action="{%  url 'task' %}" method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="task_name" class="control-label col-sm-3">Task Name:</label>
                                <div class="col-sm-8">
                                    <input id="task_name" class="form-control" type="text" name="name" required data-modalfocus>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="contest_slug" class="control-label col-sm-3">Contest:</label>
                                <div class="col-sm-8">
                                    <select class="form-control" name="contest" id="contest_slug">
                                         {% for contest in contests %}
                                         <option value="{{contest.id}}">{{contest.title}}</option>
                                         {% endfor %}
                                    </select>
                                </div>                                    
                            </div>
                            <div class="form-group">
                                <div class="col-sm-8 col-sm-offset-3">
                                    <input type="submit" class="btn btn-primary" value="Add Task" onclick="return addTask(this);">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>                                    
                            </div>                                    
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Send Notification -->
        <div class="modal fade" id="sendNotifModal" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Send Notification</h4>
                    </div>

                    <div class="modal-body">
                        <form class="form-horizontal" action="{%  url 'send_notif' %}" method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="notif_title" class="control-label col-sm-3">Title:</label>
                                <div class="col-sm-8">
                                    <input id="notif_title" class="form-control" type="text" name="title" required data-modalfocus>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notif_desc" class="control-label col-sm-3">Description:</label>
                                <div class="col-sm-8">
                                    <input id="notif_desc" class="form-control" type="text" name="description" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-8 col-sm-offset-3">
                                    <input type="submit" class="btn btn-primary" value="Send Notification" onclick="return sendNotif(this);">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
    
        function addTask(form) {
            var name = $('#task_name').val();
            if (name == "") {
                alert('Task name is empty.')
                return false;
            }
            if (/[^a-z]/.test(name)) {
                alert('Name can only contain lower-case letters.')
                return false;
            }
            return true;
        }
        function sendNotif(form) {
            var title = $('#notif_title').val();
            if (title == "") {
                alert('Title is empty.')
                return false;
            }
            var desc = $('#notif_desc').val();
            if (desc == "") {
                alert('Description is empty.')
                return false;
            }
            return true;
        }

    </script>

{% endblock %}
